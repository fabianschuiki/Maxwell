<!DOCTYPE html>
<html>
<head>
	<title>Maxwell – Environment Globals</title>
	<meta charset="utf-8"/>
	<script src="http://code.jquery.com/jquery-1.6.2.min.js" type="text/javascript"></script>
	<script src="../include/include.js" type="text/javascript"></script>
	<link rel="stylesheet" href="../include/include.css" type="text/css" />
</head>
<body>

<h1>Concept</h1>

<h2>Problem</h2>

<p>In present programming languages, the use of global variables (<em>globals</em>) is usually discouraged and considered bad style for various reasons. Nevertheless, most projects of a certain size make use of the <em>singleton pattern</em> in order to provide access to the most fundamental object instances (game engine, application, etc.), which requires a global variable.</p>

<code>A * A::getSingleton() const {
	static A *a = NULL;
	if (!a) a = new A;
	return a;
}

void main() {
	A::getSingleton()->doSomething();
}
</code>

<p>Along the same lines, if you write a compiler you end up with functions that perform certain tasks, like parsing or interpreting a statement. These procedures may emit errors, warnings or other kinds of information for the end user, which need to be collected. This might be accomplished through a singleton list of messages, or a stack based approach which pushes message lists onto a resonse stack, both requiring global variables.</p>

<code>void parse() {
	IssueList::getTop()->reportError(…);
}

void main() {
	IssueList *i = new IssueList;
	i->push();
	parse();
	i->pop();
	i->print();
	delete i;
}</code>

<h2>Approach</h2>

<p>Maxwell should <em>not provide globals at all</em>. Objects are usually associated with some kind of context, i.e. other objects that interact with them. The global scope is the scope layer that lacks any context.</p>

<p>As a substitute for globals Maxwell should provide the <em>Environment</em>, a scope-like construct that allows functions to access variables outside of their own scope. A parent function may expose a variable to the <em>environment</em>, which allows a function called by the parent to access the exposed variable.</p>

<h3>Application Singleton</h3>
<p>An application singleton object might be implemented as follows.</p>
<code>void main() {
	var Application app = new Application;
	env &lt;- app; //expose the application to the environment
	runloop();
}

void runloop() {
	env -> app; //use the application from the environment
	app.changeIcon("happy.png");
}</code>


<h1>Implementation</h1>

<p>How are we going to implement this? Implicitly passing an environment object as function argument? Using a per-thread global stack of environment objects?</p>

</body>
</html>